# Reversing

[アセンブリ言語入門](http://ext-web.edu.sgu.ac.jp/koike/CA14/assembler_content.html)

## レジスタ

### 汎用レジスタ
| reg | Tutorials               |
|:---:|:----------------------- |
| `EAX` | アキュームレータ。計算処理の実行。**関数戻り値の格納**。|
| `EDX` |データレジスタ。EAXの拡張に使用。 |
| `ECX` |ループ処理用カウンタレジスタ。下方向にカウントする。 |
| `ESI` | **文字列コピーの際のコピー元アドレス**。ループ処理用データレジスタ。ソースインデックス。入力データストリームの位置を記憶。 | 
| `EDI` | **文字列コピーの際のコピー先アドレス**。ループ処理用データレジスタ。ディスティネーションインデックス。データ処理結果格納位置のポインタ。|
| `ESP` |スタックポインタ|
| `EBP` |ベースポインタ|
| `EBX` |計算用|
| `EIP` |次に実行されるアドレスが入る|

### フラグレジスタ
| reg | Tutorials               | reg | Tutorials               |
|:---:|:----------------------- |:---:|:----------------------- |
|`ZF`<br>(Zero Flag)|演算結果がゼロのとき` 1 `、それ以外の時` 0 `|`OF`<br>(OverFlow Flag)|定められた値以上の数値になったとき` 1 `<br>算術演算の場合: -32768～32767に収まらないと` 1 `<br>論理演算の場合: 0～65535に収まらないと` 1 `|
|`SF`<br>(Sign Flag)|演算結果の符号が負の時` 1 `、それ以外` 0 `|`CF`<br>(Carry Flag)|通常の演算結果で桁あふれが発生した場合` 1 `、それ以外` 0 `|
|`PF`<br>(Parity Flag)|演算結果で、各ビットで1となるビットの合計が偶数なら` 1 `、それ以外` 0 `|

## 代表的な命令
### 代入命令
| Ope code | description |
|:--------:|-------------|
|`mov`|値をコピーする。実数値などで使われやすい。|
|`lea`<br>(Load Effective Address)|アドレスをコピーする。ポインタなどで使われやすい。|<br>

[00410000] 00000100 <br>
- mov eax, [00410000] -> eax = 00000100<br>
- lea eax, [00410000] -> eax = 00410000<br>



## ジャンプ命令
| Ope code | description |
|:--------:|-------------|
|`cmp`| 二つの値を比較する。結果はZFに反映され、一致したとき `ZF = 1`、それ以外 `ZF = 0`|
|`test`|and命令とほぼ同じだが結果は保持しない。主にZFを変動させる目的で使われる。|

|Ope clde| description |
|:------:|----------------------------|
|`JE` `JZ`| ZF = 1 なら指定位置にジャンプ|
|`JNE` `JNZ`| ZF = 0 なら指定位置にジャンプ|
|`JG`|cmp A B で、A > B なら指定位置にジャンプ。`ZF = 0 & SF = 0F`のとき。|
|`JGE`|cmp A B で、A >= B なら指定位置にジャンプ。`SF = 0F`のとき。|
|`JNGE`|cmp A B で、!(A >= B) なら指定位置にジャンプ。`SF ! 0F`のとき。|
|`JCXZ`|フラグレジスタを参照しない。CXの値が0のときジャンプ。|
|`JECX`|フラグレジスタを参照しない。ECXの値が0のときジャンプ。|


## Win32 API
### File
- [CreateFile](https://learn.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-createfilea)        :Creates or opens a file or I/O device.
- WriteFile / ReadFile
- [CloseHandle](https://learn.microsoft.com/en-us/windows/win32/api/handleapi/nf-handleapi-closehandle)   :Closes an open object handle.
- CopyFile
- MoveFile
- DeleteFile
- GetDriveTypeA
### Registry
- RegOpenkey
- RegCreateKey
- RegQueryValue
- RegCloseKey
- RegSetValue
- RegDelteValue
### Device
- CreateFile         
- DeviceControl
- CloseHandle
### Process
- CreateProcess
- CreateThrede
- ExitProcess
- TerminateProcess
### Service
- StartService
- OpenService
- ControlService
- EnumServicesStatus
- OpenSCManager
### Network
- WSAStartup
- socket, inet_addr
- [send](https://learn.microsoft.com/en-us/windows/win32/api/winsock2/nf-winsock2-send) / recv
- htons
- listen / bind
- InternetOpenURL, InternetOpen, InternetReadFile
- HttpOpenRequest, HttpSendRequest, URLDownloadToFile
### Other
- DLL Injection
    - OpenProcess, WriteProcessMemory, CreateRemoteThread
- Root Kit(.sys)
    - KiSystemService
    - NtQuerySystemInformation
- Key Logger
    - GetAsyncKeyState, GetKeyState, OpenClipboard, GetClipboardData




